!function(t){t.InstaBI=function(t){function e(){}var n=this;n.login=function(a,s,u,o){o=o||e,jQuery.ajax({url:t+"/login",success:function(t){t&&t.accessToken?(n.authData=t,o(null,t)):o(t.message,null)},error:function(t,e,n){o(t.responseText||n,null)},async:!0,type:"post",data:{username:a,password:s,remember:u}})},n.supportsSSO=function(a){a=a||e,jQuery.ajax({url:t+"/ssoValue",success:function(t){n.sso=t,a(null,t)},error:function(t,e,n){a(t.responseText||n,null)},async:!0,type:"post",data:{}})},n.loginByToken=function(a,s){s=s||e,jQuery.ajax({url:t+"/authstate?access_token="+a,success:function(t){t.success?(n.authData={accessToken:a},s(null,t)):s("Invalid token or user is not authenticated")},error:function(t,e,n){s(t.responseText||n,null)},async:!0,type:"post"})},n.logout=function(a){a=a||e,jQuery.ajax({url:t+"/logout",success:function(t){t&&t.success?(n.authData={},a(null,t)):a(t.message,null)},async:!1,type:"post"})},n.isAuthenticated=function(){return n.authData&&n.authData.accessToken},n.getSites=function(){},n.switchToSite=function(a,s){return s=s||e,n.authData&&n.authData.accessToken?void jQuery.ajax({url:t+"/sites/switch/"+a+"?access_token="+n.authData.accessToken,success:function(t){n.authData.siteId=t._id,s(null,!0)},error:function(t,e,a){if(412==t.status){var u=JSON.parse(t.responseText);n.authData.accessToken=u.token,n.authData.siteId=u.siteId,s(null,!0)}s(t.responseText||a,null)},async:!0,type:"get"}):s("Not authenticated")},n.getCurrentSite=function(){return n.authData.siteId},n.openDocument=function(a){function s(t){var e=t.indexOf("siteId=");return e!=-1?t.substr(e+7,24):""}function u(){if(a.container){a.uri.indexOf(t)==-1&&(a.uri=t+a.uri),a.showToolbar||(a.uri+="&hideToolbar=1"),a.uri+="&selfOpen=1&accessToken="+n.authData.accessToken,a.container.html("");var e=$('<iframe style="width: 100%; height: 100%;border:0;">');e.attr("src",a.uri),a.container.append(e)}}if(n.authData&&n.authData.accessToken){a=a||{siteId:"",uri:"",container:"",onError:e};var o=s(a.uri);o!=n.authData.siteId?n.switchToSite(o,function(t){return t?t:void u()}):u()}},n.getFolderItems=function(t){if(t=t||{folderId:"",siteId:"",type:"all"},t.siteId=t.siteId||n.getDefaultSite(),["all","folder","doc"].indexOf(t.type)==-1)return void console.log("error: Invalid type for folder item!")}}}(window);